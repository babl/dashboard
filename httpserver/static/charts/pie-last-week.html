<html>
<head></head>
<body>

  <div id="pieChart"></div>
  <script src="../js/d3.min.js"></script>
  <script src="../js/d3pie.min.js"></script>
  <script src="../js/underscore-min.js"></script>
  <script>
    var moduleUser = window.parent.location.pathname.substring(1)
    var dailyPath = "../../data/"+moduleUser+"/daily.json"
    d3.json(dailyPath, function(data) {
    //this week
    var fValue = function(total,day){ return day.value  + total; }
    var fError = function(total,day){ return day.error  + total; }

    // var last_week_index_from = (data.length-14)-1
    // var last_week_index_to = (data.length-7)-1
    // var data_last_week = _.filter(data,function(day,i){ return i > last_week_index_from && i <= last_week_index_to})

    var data_last_week = _.last(data,[7]);
    var last_week_value = _.reduce(data_last_week, fValue, 0);
    var last_week_error = _.reduce(data_last_week, fError, 0);
    var last_week_suc = last_week_value - last_week_error;
    
    var all_week_DailyRate = Math.floor(last_week_value/data_last_week.length);
    var footer = "Average: "+all_week_DailyRate.toLocaleString() +" requests/day";

    var pie = new d3pie("pieChart", {
      "header": {
        "title": {
          "text": "Last 7 days",
          "fontSize": 11,
          "font": "courier"
        },
        "subtitle": {
          "text": last_week_value.toLocaleString(),
          "color": "#000000",
          "font-weight": "bold",
          "fontSize": 15,
          "font": "courier"
        },
        "location": "pie-center",
        "titleSubtitlePadding": 10
      },
      "footer": {
        "text":footer,
        "color": "#999999",
        "fontSize": 11,
        "font": "open sans",
        "location": "bottom-center"
      },
      "size": {
        "canvasHeight": 200,
        "canvasWidth": 260,
        "pieInnerRadius": "63%",
        "pieOuterRadius": "83%"
      },
      "data": {
        "sortOrder": "value-asc",
        "content": [
        {
          "label": "Error",
          "value": last_week_error,
          "color": "#c12823"
        },
        {
          "label": "Success",
          "value": last_week_suc,
          "color": "#64a61f"
        }
        ]
      },
      "labels": {
        "outer": {
          "format": "label-percentage1",
          "pieDistance": 20
        },
        "inner": {
          "format": "none"
        },
        "mainLabel": {
          "fontSize": 11
        },
        "percentage": {
          "color": "#999999",
          "fontSize": 11,
          "decimalPlaces": 0
        },
        "value": {
          "color": "#cccc43",
          "fontSize": 11
        },
        "lines": {
          "enabled": true,
          "color": "#777777"
        },
        "truncation": {
          "enabled": true
        }
      },
      "tooltips": {
        "enabled": true,
        "type": "placeholder",
        "string": "{label}: {value}, {percentage}%"
      },
      "effects": {
        "pullOutSegmentOnClick": {
          "effect": "none",
          "speed": 400,
          "size": 8
        }
      },
      "misc": {
        "colors": {
          "segmentStroke": ""
        }
      },
      "callbacks": {}
    });
  });
</script>

</body>
</html>